<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Full-Stack App (Student Build)</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <style>
    /* Simple page toggle for SPA */
    .page { display: none; }
    .page.active { display: block; }
  </style>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#/home">Full-Stack App Rose Ann Villamor</a>
      <ul class="navbar-nav ms-auto">
        <!-- Visible when NOT logged in -->
        <li class="nav-item role-logged-out">
          <a class="nav-link" href="#/login">Login</a>
        </li>
        <li class="nav-item role-logged-out">
          <a class="nav-link" href="#/register">Register</a>
        </li>

        <!-- Visible when logged in -->
        <li class="nav-item dropdown role-logged-in d-none">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="navbarDropdown">
            Username
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#/profile">Profile</a></li>
            <li><a class="dropdown-item" href="#/requests">My Requests</a></li>

            <!-- Admin-only links -->
            <li><hr class="dropdown-divider role-admin d-none"></li>
            <li><a class="dropdown-item role-admin d-none" href="#/employees">Employees</a></li>
            <li><a class="dropdown-item role-admin d-none" href="#/accounts">Accounts</a></li>
            <li><a class="dropdown-item role-admin d-none" href="#/departments">Departments</a></li>

            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#/logout">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="container mt-4">
    <!-- Home -->
    <section id="home-page" class="page active">
      <h1>Home</h1>
      <p>Welcome to the Full-Stack App SPA demo!</p>
    </section>

    <!-- Register -->
    <section id="register-page" class="page">
      <h1>Register Account</h1>
      <form onsubmit="registerUser(event)">
        <div class="mb-3">
          <label for="reg-username" class="form-label">Username</label>
          <input type="text" class="form-control" id="reg-username" required>
        </div>
        <div class="mb-3">
          <label for="reg-email" class="form-label">Email</label>
          <input type="email" class="form-control" id="reg-email" required>
        </div>
        <div class="mb-3">
          <label for="reg-password" class="form-label">Password</label>
          <input type="password" class="form-control" id="reg-password" required>
        </div>
        <div class="mb-3">
          <label for="reg-role" class="form-label">Role</label>
          <select id="reg-role" class="form-select">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <!-- Green Register button -->
        <button type="submit" class="btn btn-success">Sign Up</button>
      </form>
    </section>

    <!-- Verify Email -->
    <section id="verify-email-page" class="page">
      <h1>Verify Email</h1>
      <p>Please click the button below to verify your email.</p>
      <button class="btn btn-success" onclick="verifyEmail()">Verify Email</button>
    </section>

    <!-- Login -->
    <section id="login-page" class="page">
      <h1>Login</h1>
      <form onsubmit="loginUser(event)">
        <div class="mb-3">
          <label for="login-username" class="form-label">Username</label>
          <input type="text" class="form-control" id="login-username" required>
        </div>
        <div class="mb-3">
          <label for="login-password" class="form-label">Password</label>
          <input type="password" class="form-control" id="login-password" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
      </form>
    </section>

    <!-- Profile -->
    <section id="profile-page" class="page">
      <h1>Profile</h1>
      <p id="profile-info"></p>
    </section>

    <!-- My Requests -->
    <section id="requests-page" class="page">
      <h1>My Requests</h1>
      <p id="requests-info">You have no requests yet.</p>
    </section>

    <!-- Admin Pages -->
    <section id="employees-page" class="page">
      <h1>Employees (Admin)</h1>
      <p>Admin-only employee data goes here.</p>
    </section>

    <section id="accounts-page" class="page">
      <h1>Accounts (Admin)</h1>
      <p>Admin-only accounts data goes here.</p>
    </section>

    <section id="departments-page" class="page">
      <h1>Departments (Admin)</h1>
      <p>Admin-only departments data goes here.</p>
    </section>

  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Custom JS -->
  <script>
    let users = [];
    let currentUser = null;

    function showPage(pageId) {
      document.querySelectorAll(".page").forEach(page => page.classList.remove("active"));
      const page = document.getElementById(pageId);
      if (page) page.classList.add("active");

      if(pageId === "profile-page" && currentUser) {
        document.getElementById("profile-info").textContent =
          `Username: ${currentUser.username}, Email: ${currentUser.email}, Role: ${currentUser.role}`;
      }

      const adminPages = ["employees-page", "accounts-page", "departments-page"];
      if(adminPages.includes(pageId) && (!currentUser || currentUser.role !== "admin")) {
        alert("Access denied. Admins only.");
        showPage("home-page");
      }
    }

    function updateNavbar() {
      const loggedInItems = document.querySelectorAll(".role-logged-in");
      const loggedOutItems = document.querySelectorAll(".role-logged-out");
      const adminItems = document.querySelectorAll(".role-admin");

      if (currentUser) {
        loggedInItems.forEach(el => el.classList.remove("d-none"));
        loggedOutItems.forEach(el => el.classList.add("d-none"));

        document.getElementById("navbarDropdown").textContent = currentUser.username;

        adminItems.forEach(el => {
          if(currentUser.role === "admin") el.classList.remove("d-none");
          else el.classList.add("d-none");
        });
      } else {
        loggedInItems.forEach(el => el.classList.add("d-none"));
        loggedOutItems.forEach(el => el.classList.remove("d-none"));
        adminItems.forEach(el => el.classList.add("d-none"));
      }
    }

    function registerUser(event) {
      event.preventDefault();
      const username = document.getElementById("reg-username").value;
      const email = document.getElementById("reg-email").value;
      const password = document.getElementById("reg-password").value;
      const role = document.getElementById("reg-role").value;

      if (users.some(u => u.username === username)) {
        alert("Username already exists!");
        return;
      }

      users.push({ username, email, password, role, verified: false });
      alert("Registered successfully! Please verify your email.");
      showPage("verify-email-page");
    }

    function verifyEmail() {
      if (!users.length) { alert("No user registered!"); return; }
      users[users.length-1].verified = true;
      alert("Email verified! You can now login.");
      showPage("login-page");
    }

    function loginUser(event) {
      event.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      const user = users.find(u => u.username === username && u.password === password);
      if (!user) { alert("Invalid credentials"); return; }
      if (!user.verified) { alert("Please verify your email first!"); showPage("verify-email-page"); return; }

      currentUser = user;
      updateNavbar();
      showPage("home-page");
    }

    function logoutUser() {
      currentUser = null;
      updateNavbar();
      showPage("home-page");
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateNavbar();
      document.querySelectorAll("a.nav-link, .dropdown-item").forEach(link => {
        link.addEventListener("click", e => {
          e.preventDefault();
          const href = link.getAttribute("href");

          if (href === "#/logout") { 
            logoutUser(); 
            return; 
          }

          const pageMap = {
            "#/home": "home-page",
            "#/register": "register-page",
            "#/verify": "verify-email-page",
            "#/login": "login-page",
            "#/profile": "profile-page",
            "#/requests": "requests-page",
            "#/employees": "employees-page",
            "#/accounts": "accounts-page",
            "#/departments": "departments-page"
          };

          const pageId = pageMap[href];
          if(pageId) showPage(pageId);
        });
      });
    });
  </script>
</body>
</html>
